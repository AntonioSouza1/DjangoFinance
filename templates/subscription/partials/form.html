<section class="forms" >
<div class="title-div">
    <h2>Cadastro de Assinaturas</h2>
</div>

<form method='POST'
    {% if subscription.pk %}
        hx-post="{% url 'subscription:update' subscription.pk %}"
    {% else %}
        hx-post="{% url 'subscription:create' %}"
    {% endif %}
    hx-target="#subscription_table"
    hx-swap="innerHTML">
    {% csrf_token %}

    <div class="form-button">
        <button type="submit" class="custom-button default">Salvar</button>
        {% if subscription.pk %}
            <button
                class="custom-button danger"
                hx-delete="{% url 'subscription:delete' subscription.pk %}"
                hx-target="#subscription_table"
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                hx-confirm="Deseja realmente excluir {{ subscription.description }}?">
                Excluir
            </button>
        {% endif %}
        <button type="button" class="custom-button outline" onclick="document.getElementById('dialog_form').close()">Cancelar</button>
    </div>


    <div class="grid">
        <div class="form-item">
            <label for="{{ form.supplier.id_for_label }}">Fornecedor</label>
            {{ form.supplier }}
        </div>

        <div class="form-item span-2">
            <label for="{{ form.description.id_for_label }}">Descrição</label>
            {{ form.description }}
        </div>

        <div class="form-item">
            <label for="{{ form.category.id_for_label }}">Categoria</label>
            {{ form.category }}
        </div>
    </div>
    <div class="grid">
        <div class="form-item">
            <label for="{{ form.subscription_type.id_for_label }}">Tipo de Assinatura</label>
            {{ form.subscription_type }}
        </div>

        <div class="form-item">
            <label for="{{ form.value.id_for_label }}">Valor R$</label>
            {{ form.value }}
        </div>

        <div class="form-item">
            <label for="{{ form.payment_method.id_for_label }}">Metodo de Pagamento</label>
            {{ form.payment_method }}
        </div>

        <div class="form-item">
            <label for="{{ form.renewal_day.id_for_label }}">Dia de Renovação</label>
            {{ form.renewal_day }}
        </div>

        <div class="form-item">
            <label for="{{ form.payment_frequency.id_for_label }}">Frequencia de Pagamento</label>
            {{ form.payment_frequency }}
        </div>
    </div>
    <div class="grid">

        <div class="form-item">
            <label for="create_at">Data de Assinatura</label>
            <input type="text" name="id_create_at" id="id_create_at" value="{{ object.created_at|date:"d/m/Y" }}" disabled>
        </div>

        <div class="form-item">
            <label for="update_at">Ultima Atualização</label>
            <input type="text" name="update_at" id="update_at" value="{{ object.updated_at|date:"d/m/Y" }}" disabled>
        </div>

        {% if not object.canceled_at %}
            <div class="form-item">
                <label for="{{ form.canceled_at.id_for_label }}">Data de Cancelamento</label>
                {{ form.canceled_at }}
            </div>
        {% endif %}

        {% if object.canceled_at %}
            <div class="form-item">
                <label for="canceled_at">Data de Assinatura</label>
                <input type="text" name="canceled_at" id="canceled_at" value="{{ object.created_at|date:"d/m/Y" }}" disabled>
            </div>
        {% endif%}

        <div class="form-item">
            <label for="{{ form.status.id_for_label }}">Status</label>
            {{ form.status }}
        </div>
    </div>
    <div class="grid">
        <div class="form-item">
            <label for="{{ form.observation.id_for_label }}">Observação</label>
            {{ form.observation }}
        </div>
    </div>
</form>

{% if subscription.pk %}
    <dialog id="delete">
        <form action="{% url 'subscription:delete' subscription.pk %}" method="post">
            {% csrf_token %}

        </form>
    </dialog>

    <script>
        (function() {

            const modalDelete = document.getElementById('delete');
            const btnOpenDelete = document.getElementById('open_delete');
            const btnCloseDelete = document.getElementById('btnCancelarDelete');

            if (btnOpenDelete && modalDelete) {
                btnOpenDelete.addEventListener('click', () => modalDelete.showModal());
            }

            if (btnCloseDelete && modalDelete) {
                btnCloseDelete.addEventListener('click', () => modalDelete.close());
            }
        })();

    </script>
{% endif %}
</section>

